<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="css/bootstrap.min.css" >
<!-- Latest compiled and minified JavaScript -->
<link rel="javascript" src="js/bootstrap.min.js"></script>
<script src="js/datamaps.world.min.js"></script>
<script src="js/bootstrap3-typeahead.min.js"></script>
<script src="js/datamaps.world.min.js"></script>
<style>
.map{
    
    width: 80%; 
    height: 80%;
}

.searchContainer{
    padding: 10px;
}

</style>

<script>

    var jsonCountriesObjects;
    var mapObject;
    var countries = [];

    $(function(){

    $.getJSON('data/datamapsource.json',function(data)
            {
                jsonCountriesObjects = data;
                data.forEach(function(element) {
                    countries.push(element.Name);
                }, this);

                var $input = $("#countryList");
                $input.typeahead({ source: countries});
            }).done(function(){initMap(2);});

    });

    function initMap(index)
    {
        mapObject = new Datamap(
            {
                element: document.getElementById('map'),
                projection: 'mercator',
                responsive: true,
                data: jsonCountriesObjects[index].VisaList,
                fills: {
                    defaultFill: 'grey',
                    VF: 'green',
                    VOA: 'cyan',
                    VREQ: 'red',
                    ETA: 'yellow'
                },
            });
    }

    function loadVisaFor()
    {
        var $input = $("#countryList");
        var selectedCountry = jsonCountriesObjects.filter(function(country){
            return country.Name == $input.val();
        });

        if(selectedCountry != null)
        {
            var indexOf = countries.indexOf(selectedCountry[0].Name);
            if(indexOf != null)
            {
                $("#map").remove();
                $("#mapRow").append('<div id="map" class="map"></div>');
                initMap(indexOf);
            }
        }
    }

</script>
</head>
<body>
    <div class="container">
            <form id="visaForm" class="form-inline" onsubmit="loadVisaFor()">
                <div class="form-group searchContainer">
                    <input id="countryList" type="text" placeholder="Passport country" data-provide="typeahead" class="form-control" />
                    <button id="loadVisaBtn" class="btn btn-success" role="button">Visa</button>
                </div>
            </form>
        <div id="mapRow" class="row">
            <div id="map" class="map"></div>
        </div>
    </div>
</body>
</html>
